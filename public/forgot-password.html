<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plant Advisor | Lupa Password</title>
<link rel="stylesheet" href="style.css">
<style>
.forgot-page {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-image: url('login.jpeg');
    background-size: cover;
    background-position: center;
    padding: 20px;
}
.forgot-card {
    width: 100%;
    max-width: 380px;
    background: rgba(255, 255, 255, 0.13);
    backdrop-filter: blur(10px);
    padding: 25px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
}
.forgot-title {
    text-align: center;
    font-size: 24px;
    margin-bottom: 10px;
    font-weight: bold;
}
.forgot-text {
    text-align: center;
    font-size: 14px;
    margin-bottom: 20px;
    opacity: 0.9;
}
.forgot-form label {
    margin-top: 10px;
    display: block;
    font-size: 14px;
}
.forgot-form input {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 6px;
    border: 1px solid #ccc;
    outline: none;
    color: #333;
}
.error-msg {
    color: #ff4d4d;
    font-size: 13px;
    margin-top: 3px;
    height: 16px;
}
.success-msg {
    color: #00ff9d;
    font-size: 14px;
    text-align: center;
    margin: 10px 0;
}
.btn-reset {
    margin-top: 15px;
    width: 100%;
    padding: 10px;
    background: #4caf50;
    border: none;
    border-radius: 6px;
    color: white;
    font-size: 16px;
    cursor: pointer;
}
.back-login {
    text-align: center;
    margin-top: 15px;
    font-size: 14px;
}
.back-login a {
    color: white;
    text-decoration: none;
    font-weight: 500;
}
</style>
</head>

<body>
<div class="forgot-page">
    <div class="forgot-card">
        <h1 class="forgot-title">Lupa Password</h1>
        <p class="forgot-text">
            Masukkan email yang terhubung dengan akun Anda.
        </p>
        <form id="forgotForm" class="forgot-form">
            <label for="email">Email</label>
            <input type="text" id="email" placeholder="Masukkan Email Anda">
            <p id="emailError" class="error-msg"></p>
            <button type="submit" class="btn-reset">Kirim Link Reset</button>
            <p id="successMsg" class="success-msg"></p>
        </form>
        <p class="back-login">
            <a href="login.html">‚Üê Kembali ke Login</a>
        </p>
    </div>
</div>

<script>
    const API_BASE_URL = 'http://127.0.0.1:8000/api'; // <<< WAJIB GANTI URL BE ANDA >>>
    
    const forgotForm = document.getElementById("forgotForm");
    const emailInput = document.getElementById("email");
    const emailError = document.getElementById("emailError");
    const successMsg = document.getElementById("successMsg");
    const submitButton = forgotForm.querySelector('.btn-reset');

    forgotForm.addEventListener("submit", async function(e) {
        e.preventDefault();

        emailError.textContent = "";
        successMsg.textContent = "";
        emailInput.style.border = "1px solid #ccc";

        const email = emailInput.value.trim();
        const emailPattern = /^[^ ]+@[^ ]+\.[a-z]{2,3}$/;

        // 1. Validasi Lokal
        if (email === "") {
            emailError.textContent = "Email tidak boleh kosong";
            emailInput.style.border = "2px solid red";
            return;
        }
        if (!emailPattern.test(email)) {
            emailError.textContent = "Format email tidak valid";
            emailInput.style.border = "2px solid red";
            return;
        }

        emailInput.style.border = "2px solid green";

        // 2. Kirim Permintaan ke API
        submitButton.disabled = true; 
        submitButton.textContent = "Mengirim...";

        const payload = { email: email };

        try {
            const response = await fetch(`${API_BASE_URL}/forgot-password`, { 
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const data = await response.json();

            // 3. Penanganan Respons
            if (response.ok) { 
                successMsg.textContent = data.message || "Link reset password telah dikirim ke email Anda.";
                emailInput.value = ""; 
                emailInput.style.border = "1px solid #ccc";
                emailError.textContent = ""; // Pastikan error hilang jika sukses

            } else { 
                if (response.status === 422 && data.errors && data.errors.email) {
                    emailError.textContent = data.errors.email.join(' ');
                    emailInput.style.border = "2px solid red";
                } else {
                    emailError.textContent = data.message || `Gagal memproses permintaan (Status: ${response.status}).`;
                    emailInput.style.border = "2px solid red";
                }
            }

        } catch (error) {
            emailError.textContent = "Koneksi ke server gagal. Pastikan Backend berjalan.";
            emailInput.style.border = "2px solid red";
        } finally {
            submitButton.disabled = false;
            submitButton.textContent = "Kirim Link Reset";
        }
    });
</script>
</body>
</html>