<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Hasil Rekomendasi - PlantAdvisor</title>

    <link rel="stylesheet" href="style.css" /> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">


    <style>
        body {
            background-color: #f3f4f6;
            font-family: 'Inter', sans-serif;
            color: #1e293b;
            margin: 0;
            padding: 0;
        }

        .card-tanaman { display: none; } /* Disembunyikan untuk dipanggil JS */

        .container-detail {
            max-width: 850px;
            margin: 40px auto;
            padding: 20px;
        }

        .content-box {
            background: #fff;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid #eee;
        }

        .plant-header {
            display: flex;
            align-items: center;
            gap: 25px;
            margin-bottom: 30px;
        }

        .plant-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 20px;
            background: #f0f0f0;
        }

        .plant-header h3 {
            font-size: 28px;
            font-weight: 800;
            margin: 0;
            color: #1a365d;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin: 35px 0 20px;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Styling Step 1-5 */
        .step {
            background: #f8fafc;
            border-radius: 18px;
            padding: 20px 25px;
            margin-bottom: 15px;
            display: flex;
            gap: 20px;
            border-left: 6px solid #c1d72e;
            transition: transform 0.2s ease;
        }

        .step:hover {
            transform: translateX(5px);
        }

        .step-number {
            background: #c1d72e;
            color: #fff;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            flex-shrink: 0;
            font-size: 14px;
            box-shadow: 0 4px 10px #c1d72e;
        }

        .step-content h5 {
            margin: 0 0 8px 0;
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
        }

        .steps-list {
            list-style: none;
            padding: 0;
            margin: 0 !important;
        }

        .steps-list li {
            position: relative;
            padding-left: 25px;
            font-size: 14.5px;
            color: #475569;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .steps-list li::before {
            content: "ğŸŒ±";
            position: absolute;
            left: 0;
            font-size: 12px;
            top: 3px;
        }

        .action-buttons {
            text-align: center;
            margin-top: 50px;
        }

        .btn-large {
            padding: 18px 50px;
            background-color: #c1d72e;
            color: black;
            border-radius: 15px;
            font-weight: 700;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }
        .btn-large:hover {
             background-color: #9fb22b;
            transform: translateY(-2px);
}

        .analysis-box {
            background: #f9fbe7;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 4px solid #c1d72e;
            font-size: 14px;
            line-height: 1.6;
        }
        .latin-name {
    font-size: 0.8em;
}
/* Gaya untuk Header Step yang bisa diklik */
.step-header {
    display: flex;
    align-items: center;
    gap: 20px;
    cursor: pointer;
    width: 100%;
}

/* Sembunyikan konten secara default */
.step-content {
    display: none;
    padding-top: 15px;
    padding-left: 55px; /* Menyesuaikan posisi dengan angka */
}

/* Ikon panah/dropdown */
.step::after {
    content: 'â–¼';
    font-size: 12px;
    color: #94a3b8;
    margin-left: auto;
    transition: transform 0.3s ease;
}

/* Class aktif saat dropdown terbuka */
.step.active::after {
    transform: rotate(180deg);
}

.step.active .step-content {
    display: block;
}

/* Penyesuaian padding step agar lebih rapi */
.step {
    flex-direction: column; /* Ubah ke kolom agar konten di bawah header */
    align-items: flex-start;
}
    </style>
</head>

<body>
<header class="main-header">
    <div class="logo">PlantAdvisor</div>
    <div class="header-buttons" id="headerButtons"></div>
</header>
<main class="container-detail">
    <h2 class="page-title" style="font-weight: 800; margin-bottom: 30px;">
        <a href="beranda.html" style="text-decoration: none; color: #334155;">&lt;</a> Hasil Rekomendasi
    </h2>

    <div id="loading-state" class="content-box" style="text-align: center;">
        <p>âš™ï¸ <b>Menganalisis data tanah...</b></p>
    </div>

    <div id="empty-state" class="content-box" style="display:none; text-align:center;">
    <p><b>ğŸŒ± Tidak ada rekomendasi tanaman</b></p>
    <p>Data tanah tidak sesuai dengan tanaman yang tersedia.</p>
    </div>


    <div id="result-wrapper"></div>

    <div id="tpl-padi" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="padi.png" class="plant-image" alt="Padi"/>
            <h3>Tanaman Padi <span class="latin-name">(Oryza sativa)</span></h3>

        </div>
        
        <h4 class="section-title">ğŸŒ¾ Panduan Budidaya - Panen</h4>

        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">1</div>
        <h4>Pemilihan Benih</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Umur varietas benih yang digunakan (Â±110â€“120 hari).</li>
                    <li>Kualitas benih yang digunakan, meliputi: Benih bermutu, Benih sehat, Daya tumbuh tinggi.</li>
                </ul>
            </div>
        </div>
        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">2</div>
        <h4>Penyemaian</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Umur bibit saat siap dipindahkan ke lahan tanam (Â±19â€“23 hari).</li>
                    <li>Bibit berasal dari persemaian yang terkelola dengan baik.</li>
                    <li>Bibit memiliki pertumbuhan seragam dan sehat.</li>
                    <li>Bibit tidak mengalami stres sebelum penanaman.</li>
                    <li>Bibit siap tanam sesuai standar teknis budidaya padi.</li>
                </ul>
            </div>
        </div>
        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">3</div>
        <h4>Penanaman</h4>
    </div>
    <div class="step-content">
         <ul class="steps-list">
                     <li>Kondisi lahan saat tanam (macak-macak).</li>
                    <li>Jumlah bibit per lubang tanam (1â€“3 bibit)</li>
                    <li>Kepadatan populasi tanaman:
                        <ul>
                            <li>Minimal 25 rumpun/mÂ²</li>
                            <li>Â± 2 batang per rumpun</li>
                        </ul>
                    </li>

                    <li>Jarak tanam yang digunakan, antara lain:
                        <ol>
                            <li>
                                Jajar legowo:
                                <ul>
                                    <li>50 Ã— (25 Ã— 12,5) cm</li>
                                    <li>40 Ã— (20 Ã— 10) cm</li>
                                </ul>
                            </li>
                            <li>
                                Persegi:
                                <ul>
                                    <li>25 Ã— 25 cm</li>
                                    <li>20 Ã— 20 cm</li>
                                </ul>
                            </li>
                        </ol>
                    </li>
                </ul>
            </div>
        </div>
        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">4</div>
        <h4>Pemeliharaan</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li> Penggunaan alat bantu pemupukan (hand sprayer/teknologi lain).</li>
                    <li>Tidak melakukan tabur pupuk secara langsung.</li>
                    <li>Penggunaan alat pemupukan dapat menghemat waktu dan tenaga kerja.</li>
                </ul>
            </div>
        </div>
        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">5</div>
        <h4>Panen</h4>
    </div>
    <div class="step-content">
         <ul class="steps-list">
                    <li>Penggunaan mesin panen (combine harvester, reaper, binder).</li>
                    <li>Efisiensi mesin panen terhadap waktu dan biaya tenaga kerja.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tpl-jagung" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="jagung.jpeg" class="plant-image" alt="Jagung"/>
            <h3>Tanaman Jagung <span class="latin-name">(Zea mays)</span></h3>

        </div>
        <h4 class="section-title">ğŸŒ½ Panduan Budidaya - Panen</h4>

         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">1</div>
        <h4>Pemilihan Benih</h4>
    </div>
    <div class="step-content">
       <ul class="steps-list">
                    <li>Gunakan benih jagung unggul yang sesuai dengan kondisi lingkungan setempat.</li>
                    <li>Pilih varietas tahan panas, kekeringan, dan tanam rapat.</li>
                    <li>Varietas hibrida lebih adaptif dan berproduksi stabil.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">2</div>
        <h4>Penyemaian</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Metode tanam berkembang dari tabur sebar, ke tanam barisan, hingga tanam presisi.</li>
                    <li>Tanam presisi membuat jarak dan kedalaman benih lebih seragam sehingga kecambah tumbuh lebih baik.</li>
                    <li>Keseragaman tumbuh penting untuk membentuk populasi tanaman yang optimal sejak awal.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">3</div>
        <h4>Penanaman</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Jarak dan kepadatan tanam diatur agar tanaman tidak saling bersaing.</li>
                    <li>Sistem tanam presisi dan guludan meningkatkan efisiensi cahaya dan hasil.</li>
                    <li>Waktu tanam disesuaikan untuk menghindari cuaca ekstrem.</li>
                    <li>Teknologi GPS dan mesin presisi membuat tanam lebih akurat dan seragam..</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">4</div>
        <h4>Pemeliharaan</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Kepadatan tinggi membuat jagung menyesuaikan bentuk daun dan tajuk.</li>
                    <li>Pengaturan jarak dan kepadatan tanam mengurangi persaingan cahaya, air, dan hara.</li>
                    <li>Teknologi sensor dan pemupukan tepat meningkatkan efisiensi pupuk dan ketahanan tanaman.</li>
                    <li>Penyesuaian varietas dan sistem tanam membantu jagung menghadapi perubahan iklim.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">5</div>
        <h4>Panen</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Panen optimal dicapai jika tanaman tumbuh seragam sejak awal.</li>
                    <li>Tanam presisi dan kepadatan yang tepat meningkatkan jumlah dan bobot biji.</li>
                    <li>Waktu tanam dan varietas yang sesuai membantu jagung matang pada kondisi lingkungan yang lebih baik.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tpl-tebu" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="tebu.png" class="plant-image" alt="Tebu"/>
            <h3>
            Tanaman Tebu 
            <span class="latin-name" style="font-size: 0.8em;">
                 (Saccharum officinarum)
            </span>
            </h3>


        </div>
        <h4 class="section-title">ğŸ‹ Panduan Budidaya - Panen</h4>

         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">1</div>
        <h4>Pemilihan Benih</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li> Pilih varietas tebu unggul sesuai kondisi lahan.</li>
                    <li>Gunakan bibit vegetatif berupa bagal dari tanaman sehat.</li>
                    <li>Pastikan bibit bebas hama dan penyakit.</li>
                    <li>Pastikan bibit bebas hama dan penyakit.</li>
                    <li>Pilih batang dengan mata tunas aktif dan segar.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">2</div>
        <h4>Penyemaian</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                  <li>Potong batang tebu menjadi bagal sesuai jumlah mata tunas.</li>
                    <li>Simpan bibit di tempat teduh sebelum tanam.</li>
                    <li>Lakukan seleksi ulang untuk memastikan daya tumbuh bibit.</li>
                    <li>Siapkan bibit cadangan untuk penyulaman bila diperlukan.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">3</div>
        <h4>Penanaman</h4>
    </div>
    <div class="step-content">
       <ul class="steps-list">
            <li> Olah lahan hingga gembur dan memiliki drainase baik.</li>
                    <li>Buat alur tanam sesuai jarak tanam yang dianjurkan.</li>
                    <li>Letakkan bagal secara horizontal di dalam alur.</li>
                   <li>Tutup bibit dengan tanah secara merata.</li>
                   <li>Penanaman disesuaikan dengan musim dan ketersediaan air.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">4</div>
        <h4>Pemeliharaan</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Lakukan penyulaman pada tanaman yang tidak tumbuh.</li>
                    <li>Lakukan pemupukan sesuai dosis dan fase pertumbuhan.</li>
                    <li>Kendalikan gulma secara manual atau kimiawi.</li>
                    <li>Lakukan pembumbunan untuk memperkuat batang.</li>
                    <li>Jaga sistem drainase agar tidak terjadi genangan air.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">5</div>
        <h4>Panen</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Panen dilakukan saat tebu mencapai kemasakan optimal.</li>
                    <li>Cek kematangan dengan pengukuran kadar brix.</li>
                    <li>Potong batang tebu dekat permukaan tanah</li>
                    <li>Kumpulkan dan angkut tebu ke tempat pengolahan.</li>
                    <li>Hindari kerusakan batang saat proses panen.</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="action-buttons">
        <a href="beranda.html" class="btn-large">Selesai / Kembali ke Beranda</a>
    </div>
</main>

<script>
    const API_BASE_URL = "http://plantadvisor.cloud/api";

    document.addEventListener("DOMContentLoaded", () => {
        fetchRecommendation();
    });

async function fetchRecommendation() {
    const inputId = localStorage.getItem("input_id");

    // jika input_id tidak ada
    if (!inputId) {
        document.getElementById("loading-state").style.display = "none";
        document.getElementById("empty-state").style.display = "block";
        return;
    }

    try {
        const res = await fetch(`${API_BASE_URL}/recommendation/${inputId}`);
        const result = await res.json();

        document.getElementById("loading-state").style.display = "none";

        // jika ada rekomendasi
        if (
            res.ok &&
            Array.isArray(result.recommendations) &&
            result.recommendations.length > 0
        ) {
            renderCards(result.recommendations);
        } 
        // jika kosong / gagal
        else {
            document.getElementById("empty-state").style.display = "block";
        }
    } catch (error) {
        console.error(error);
        document.getElementById("loading-state").style.display = "none";
        document.getElementById("empty-state").style.display = "block";
    }
}


    function renderCards(data) {
        const wrapper = document.getElementById("result-wrapper");
        wrapper.innerHTML = "";
        
        data.forEach(item => {
            const name = item.nama_tanaman.toLowerCase();
            let id = name.includes("padi") ? "tpl-padi" :
                     name.includes("tebu") ? "tpl-tebu" : 
                     name.includes("jagung") ? "tpl-jagung" : null;
            
            if (!id) return;

            const clone = document.getElementById(id).cloneNode(true);
            clone.removeAttribute("id");
            clone.style.display = "block";

            // Tambahkan Box Analisis dari Database
            const analysis = document.createElement("div");
            analysis.className = "analysis-box";
            analysis.innerHTML = `<b>Ensiklopedia</b><br>${item.care_instructions.replace(/\n/g,"<br>")}`;

            clone.insertBefore(analysis, clone.querySelector(".section-title"));
            wrapper.appendChild(clone);
        });
    }
    // Fungsi untuk toggle dropdown
function toggleStep(element) {
    // Menutup step lain yang sedang terbuka (Opsional, hapus jika ingin bisa buka banyak sekaligus)
    /*
    const allSteps = document.querySelectorAll('.step');
    allSteps.forEach(step => {
        if(step !== element) step.classList.remove('active');
    });
    */

    // Toggle class active pada elemen yang diklik
    element.classList.toggle('active');
}

// Pastikan fungsi renderCards tetap berjalan seperti biasa, 
// karena struktur internalnya sudah kita siapkan di template.
</script>
</body>
</html>