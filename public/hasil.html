<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Hasil Rekomendasi - PlantAdvisor</title>

    <link rel="stylesheet" href="style.css" /> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        .card-tanaman { display: none; }
        .container-detail {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            font-family: 'Inter', sans-serif;
        }

        .content-box {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 30px;
            margin-bottom: 30px;
            border: none;
        }

        .plant-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .plant-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 12px;
        }

        .plant-header h3 {
            font-size: 28px;
            font-weight: 800;
            color: #1a365d;
            margin: 0;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin: 30px 0 20px;
            color: #2c3e50;
        }

        .step {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            gap: 15px;
            border-left: 5px solid #a3e635; /* Hijau limau */
        }

        .step-number {
            background: #a3e635;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            font-size: 14px;
        }

        .step-content h5 {
            margin: 0 0 10px 0;
            font-size: 18px;
            font-weight: 700;
            color: #334155;
        }

        .steps-list {
            list-style: none;
            padding: 0;
            margin: 0 !important;
        }

        .steps-list li {
            position: relative;
            padding-left: 25px;
            font-size: 15px;
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .steps-list li::before {
            content: "üå±";
            position: absolute;
            left: 0;
            font-size: 12px;
            top: 2px;
        }

        .action-buttons {
            text-align: center;
            margin-top: 40px;
        }

        .btn-large {
            padding: 15px 40px;
            background-color: #a3e635;
            color: #fff;
            border-radius: 12px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            border: none;
        }
    </style>
</head>

<body>
<header class="main-header">
    <div class="logo">PlantAdvisor</div>
    <nav class="main-nav"><a href="beranda.html">Beranda</a></nav>
    <div class="header-buttons" id="headerButtons"></div>
</header>

<main class="container-detail">
    <h2 class="page-title">
        <a href="beranda.html" class="back-link">&lt;</a> Hasil Rekomendasi Tanaman
    </h2>

    <div id="loading-state" class="content-box">
        <p>‚öôÔ∏è <b>Memproses data tanah...</b> Mohon tunggu sebentar.</p>
    </div>

    <div id="result-wrapper"></div>

    <div id="tpl-padi" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="padi.png" class="plant-image" alt="Padi"/>
            <h3>Tanaman Padi</h3>
        </div>
        
        <h4 class="section-title">üåæ Panduan Budidaya Lengkap</h4>

        <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
                <h5>Pemilihan Benih & Persemaian</h5>
                <ul class="steps-list">
                    <li>Gunakan benih unggul bersertifikat untuk hasil tinggi.</li>
                    <li>Rendam benih dalam air garam; pilih yang tenggelam.</li>
                    <li>Rendam kembali dalam air bersih selama 24 jam.</li>
                    <li>Semai di bedengan basah selama 18-22 hari.</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
                <h5>Penanaman & Pemeliharaan</h5>
                <ul class="steps-list">
                    <li>Pindahkan bibit dengan sistem Jajar Legowo.</li>
                    <li>Berikan pupuk Urea, SP-36, dan KCl secara berkala.</li>
                    <li>Jaga genangan air 2-5 cm di fase awal pertumbuhan.</li>
                    <li>Bersihkan gulma secara rutin pada umur 21 dan 42 hari.</li>
                    <li>Kendalikan hama wereng menggunakan pestisida organik jika perlu.</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
                <h5>Proses Panen</h5>
                <ul class="steps-list">
                    <li>Cek kematangan gabah saat 95% butir sudah menguning.</li>
                    <li>Pastikan tekstur biji keras saat ditekan kuku.</li>
                    <li>Gunakan mesin sabit atau combine harvester untuk efisiensi.</li>
                    <li>Keringkan gabah hingga kadar air 14% untuk penyimpanan.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tpl-tebu" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="tebu.png" class="plant-image" alt="Tebu"/>
            <h3>Tanaman Tebu</h3>
        </div>
        
        <h4 class="section-title">üéã Panduan Budidaya Lengkap</h4>

        <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
                <h5>Persiapan Lahan & Bibit</h5>
                <ul class="steps-list">
                    <li>Bajak tanah sedalam 30 cm agar akar gampang masuk.</li>
                    <li>Buat juringan (parit) dengan jarak antar pusat 110-120 cm.</li>
                    <li>Pilih bibit stek yang memiliki 3 mata tunas aktif.</li>
                    <li>Rendam stek dalam air panas (HWT) untuk cegah penyakit.</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
                <h5>Penanaman & Perawatan</h5>
                <ul class="steps-list">
                    <li>Letakkan stek mendatar dan sambung-menyambung.</li>
                    <li>Tutup stek dengan tanah tipis (sekitar 5-7 cm).</li>
                    <li>Lakukan pembumbunan (urug tanah) pada umur 1-3 bulan.</li>
                    <li>Lakukan "Klentek" atau buang daun kering setiap 2 bulan.</li>
                    <li>Pastikan drainase lancar agar akar tidak busuk.</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
                <h5>Panen & Pasca Panen</h5>
                <ul class="steps-list">
                    <li>Tentukan waktu panen saat rendemen gula mencapai maksimal.</li>
                    <li>Ciri tebu siap panen adalah daun atas sudah mengering.</li>
                    <li>Tebang tebu serapat mungkin dengan tanah (pangkal manis).</li>
                    <li>Kirim ke pabrik gula maksimal 24 jam setelah ditebang.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tpl-jagung" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="jagung.jpeg" class="plant-image" alt="Jagung"/>
            <h3>Tanaman Jagung</h3>
        </div>
        
        <h4 class="section-title">üåΩ Panduan Budidaya Lengkap</h4>

        <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
                <h5>Penyiapan & Penanaman</h5>
                <ul class="steps-list">
                    <li>Pilih benih hibrida yang tahan terhadap penyakit bulai.</li>
                    <li>Tanam dengan sistem tugal sedalam 5 cm.</li>
                    <li>Gunakan jarak tanam ideal 70 x 20 cm.</li>
                    <li>Berikan pupuk dasar organik di sekitar lubang tanam.</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
                <h5>Pemeliharaan Vegetatif</h5>
                <ul class="steps-list">
                    <li>Lakukan penyulaman maksimal 7 hari setelah tanam.</li>
                    <li>Pupuk susulan pertama di umur 15-20 HST (Urea/NPK).</li>
                    <li>Pupuk susulan kedua saat tanaman berumur 35-40 HST.</li>
                    <li>Lakukan penyiangan gulma agar tidak berebut nutrisi.</li>
                    <li>Pastikan air cukup saat fase pembungaan dimulai.</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
                <h5>Panen & Pengeringan</h5>
                <ul class="steps-list">
                    <li>Panen saat klobot (kulit) sudah berwarna cokelat kering.</li>
                    <li>Cek biji; jika sudah muncul 'black layer', jagung sudah tua.</li>
                    <li>Kupas klobot dan segera lakukan pemipilan.</li>
                    <li>Jemur biji jagung hingga kadar air di bawah 14%.</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="action-buttons">
        <a href="beranda.html" class="btn-large">Selesai / Kembali ke Beranda</a>
    </div>
</main>
<footer class="footer">¬© 2025 PlantAdvisor</footer>

<script>
const API_BASE_URL = "http://plantadvisor.cloud/api";

document.addEventListener("DOMContentLoaded", () => {
    fetchRecommendation();
    updateHeaderButtons();
});

async function fetchRecommendation() {
    const inputId = localStorage.getItem("input_id");
    if (!inputId) return;

    const token = localStorage.getItem("token");
    const headers = token ? { Authorization: `Bearer ${token}` } : {};

    const res = await fetch(`${API_BASE_URL}/recommendation/${inputId}`, { headers });
    const result = await res.json();

    document.getElementById("loading-state").style.display = "none";

    if (res.ok && result.recommendations) {
        renderCards(result.recommendations);
    }
}

function renderCards(data) {
    const wrapper = document.getElementById("result-wrapper");
    wrapper.innerHTML = "";

    data.forEach(item => {
        const name = item.nama_tanaman.toLowerCase();
        let id = name.includes("padi") ? "tpl-padi" :
                 name.includes("tebu") ? "tpl-tebu" :
                 name.includes("jagung") ? "tpl-jagung" : null;
        if (!id) return;

        const clone = document.getElementById(id).cloneNode(true);
        clone.removeAttribute("id");
        clone.style.display = "block";

        const reason = document.createElement("div");
        reason.className = "plant-description";
        reason.style.background = "#eefaf2";
        reason.style.padding = "10px";
        reason.style.borderLeft = "4px solid #27ae60";
        reason.innerHTML = `<strong>üí° Rekomendasi Sistem:</strong><br>${item.care_instructions.replace(/\n/g,"<br>")}`;

        clone.insertBefore(reason, clone.querySelector(".section-title"));
        wrapper.appendChild(clone);
    });
}

function updateHeaderButtons() {
    const el = document.getElementById("headerButtons");
    el.innerHTML = localStorage.getItem("token")
        ? `<a href="#" class="btn btn-logout" onclick="logout(event)">Logout</a>`
        : `<a href="login.html" class="btn btn-primary">Login</a>`;
}

function logout(e){
    e.preventDefault();
    localStorage.clear();
    location.href = "beranda.html";
}
</script>
</body>
</html>