<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Hasil Rekomendasi - PlantAdvisor</title>

    <link rel="stylesheet" href="style.css" /> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        .card-tanaman { display: none; }
        .container-detail {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }
        #loading-state, #error-state {
            text-align: center;
            padding: 40px;
        }
        .steps-list {
    list-style-type: none;
    padding-left: 0;
    margin-bottom: 25px;
}

.steps-list li {
    position: relative;
    padding-left: 25px;
    margin-bottom: 8px;
    line-height: 1.6;
    color: #444;
}

.steps-list li::before {
    content: "âœ”ï¸";
    position: absolute;
    left: 0;
    color: #27ae60;
    font-size: 14px;
}

.section-title {
    margin-top: 20px;
    color: #2c3e50;
    border-bottom: 2px solid #eee;
    padding-bottom: 5px;
}
    </style>
</head>

<body>
<header class="main-header">
    <div class="logo">PlantAdvisor</div>
    <nav class="main-nav">
        <a href="beranda.html">Beranda</a>
    </nav>
    <div class="header-buttons" id="headerButtons"></div>
</header>

<main class="container-detail">
    <h2 class="page-title">
        <a href="beranda.html" class="back-link">&lt;</a> Hasil Rekomendasi Tanaman
    </h2>

    <div id="loading-state" class="content-box">
        <p>âš™ï¸ <b>Memproses data tanah...</b> Mohon tunggu sebentar.</p>
    </div>

    <div id="error-state" class="content-box" style="display:none; border-left:5px solid #e74c3c;">
        <p id="error-message">âŒ Gagal memuat rekomendasi.</p>
    </div>

    <div id="result-wrapper"></div>

       <div id="tpl-padi" class="card-tanaman content-box">
    <div class="plant-header">
        <img src="padi.png" class="plant-image" alt="Padi"/>
        <h3>Tanaman Padi (Oryza sativa)</h3>
    </div>
    
    <h4 class="section-title">ğŸ—ï¸ 1. Persiapan Lahan</h4>
    <ul class="steps-list">
        <li>Bersihkan lahan dari sisa jerami dan rumput liar (gulma).</li>
        <li>Genangi lahan dengan air selama 1-2 minggu untuk melunakkan tanah.</li>
        <li>Bajak tanah sedalam 20-25 cm hingga menjadi lumpur halus.</li>
        <li>Berikan pupuk organik (kompos/manure) sebagai pupuk dasar.</li>
        <li>Ratakan permukaan tanah agar distribusi air nantinya merata.</li>
    </ul>

    <h4 class="section-title">ğŸŒ± 2. Pemilihan Bibit</h4>
    <ul class="steps-list">
        <li>Gunakan benih bersertifikat dengan daya tumbuh di atas 90%.</li>
        <li>Rendam benih dalam air garam; buang benih yang mengapung.</li>
        <li>Rendam benih pilihan dalam air bersih selama 24-48 jam.</li>
        <li>Semai benih di bedengan khusus selama 15-20 hari hingga berdaun 3-4 helai.</li>
    </ul>

    <h4 class="section-title">ğŸŒ¾ 3. Penanaman</h4>
    <ul class="steps-list">
        <li>Pindahkan bibit dari persemaian ke sawah dengan hati-hati.</li>
        <li>Tanam 2-3 bibit per lubang tanam dengan kedalaman 2-3 cm.</li>
        <li>Gunakan sistem Jajar Legowo (2:1) untuk sirkulasi udara yang lebih baik.</li>
        <li>Pastikan kondisi tanah dalam keadaan macak-macak (basah lembap).</li>
    </ul>

    <h4 class="section-title">ğŸ’§ 4. Perawatan & Pemupukan</h4>
    <ul class="steps-list">
        <li>Lakukan penyulaman (mengganti bibit mati) maksimal 7 hari setelah tanam.</li>
        <li>Cabut rumput liar secara manual atau dengan alat (matun) setiap 3 minggu.</li>
        <li>Berikan pupuk Urea, SP-36, dan KCl sesuai fase pertumbuhan (vegetatif & generatif).</li>
        <li>Atur ketinggian air: genangi saat awal tanam, keringkan saat fase pengisian bulir.</li>
        <li>Waspadai serangan tikus, burung, dan wereng coklat.</li>
    </ul>
</div>

<div id="tpl-tebu" class="card-tanaman content-box">
    <div class="plant-header">
        <img src="tebu.png" class="plant-image" alt="Tebu"/>
        <h3>Tanaman Tebu (Saccharum officinarum)</h3>
    </div>

    <h4 class="section-title">ğŸ—ï¸ 1. Persiapan Lahan</h4>
    <ul class="steps-list">
        <li>Pilih lahan terbuka yang terpapar sinar matahari penuh sepanjang hari.</li>
        <li>Buat saluran drainase yang baik agar air tidak menggenang di akar.</li>
        <li>Buat lubang tanam memanjang (juringan) dengan kedalaman 25-30 cm.</li>
        <li>Lakukan pengapuran (Dolomit) jika pH tanah terlalu asam (di bawah 5.5).</li>
    </ul>

    <h4 class="section-title">ğŸŒ± 2. Pemilihan Bibit</h4>
    <ul class="steps-list">
        <li>Gunakan bibit stek batang yang memiliki 2-3 mata tunas yang sehat.</li>
        <li>Pastikan bibit berasal dari tanaman induk berumur 6-8 bulan.</li>
        <li>Rendam stek dalam air panas (50Â°C) selama 10 menit untuk mencegah jamur.</li>
        <li>Pastikan kulit stek tidak keriput dan mata tunas menonjol segar.</li>
    </ul>

    <h4 class="section-title">ğŸ‹ 3. Penanaman</h4>
    <ul class="steps-list">
        <li>Letakkan stek secara mendatar di dasar juringan secara bersambung.</li>
        <li>Tutup stek dengan tanah setebal 5-7 cm saja.</li>
        <li>Pastikan mata tunas menghadap ke samping atau ke atas.</li>
        <li>Waktu tanam terbaik adalah awal musim kemarau dengan bantuan irigasi.</li>
    </ul>

    <h4 class="section-title">ğŸ’§ 4. Perawatan & Pemupukan</h4>
    <ul class="steps-list">
        <li>Lakukan pembumbunan (penimbunan tanah) agar batang tebu tidak mudah roboh.</li>
        <li>Lakukan "Klentek" (membuang daun kering) untuk mempercepat pematangan batang.</li>
        <li>Berikan pupuk kaya Nitrogen di awal pertumbuhan dan Kalium di fase akhir.</li>
        <li>Lakukan pengairan berkala, terutama saat fase pertumbuhan batang tercepat.</li>
        <li>Kendalikan hama penggerek batang dengan agen hayati atau pestisida tepat dosis.</li>
    </ul>
</div>

<div id="tpl-jagung" class="card-tanaman content-box">
    <div class="plant-header">
        <img src="jagung.png" class="plant-image" alt="Jagung"/>
        <h3>Tanaman Jagung (Zea mays)</h3>
    </div>

    <h4 class="section-title">ğŸ—ï¸ 1. Persiapan Lahan</h4>
    <ul class="steps-list">
        <li>Gemburkan tanah dengan cangkul atau traktor sedalam 15-20 cm.</li>
        <li>Buat bedengan jika lahan cenderung basah untuk mencegah busuk akar.</li>
        <li>Campurkan pupuk kandang sebanyak 1-2 ton per hektar sebagai nutrisi dasar.</li>
        <li>Bersihkan gulma agar tidak berebut nutrisi dengan bibit jagung.</li>
    </ul>

    <h4 class="section-title">ğŸŒ± 2. Pemilihan Bibit</h4>
    <ul class="steps-list">
        <li>Gunakan benih varietas hibrida atau unggul yang sesuai dengan ketinggian lokasi.</li>
        <li>Pastikan benih sudah diberi perlakuan (seed treatment) fungisida.</li>
        <li>Pilih benih yang memiliki ukuran seragam untuk pertumbuhan yang rata.</li>
        <li>Pastikan kemasan benih belum kedaluwarsa untuk menjamin daya tumbuh.</li>
    </ul>

    <h4 class="section-title">ğŸŒ½ 3. Penanaman</h4>
    <ul class="steps-list">
        <li>Tanam dengan sistem tugal (lubang kecil) sedalam 3-5 cm.</li>
        <li>Isi 1-2 biji per lubang tanam.</li>
        <li>Gunakan jarak tanam ideal (75 cm x 20 cm) agar sinar matahari masuk optimal.</li>
        <li>Tutup lubang dengan tanah tipis tanpa perlu dipadatkan secara berlebihan.</li>
    </ul>

    <h4 class="section-title">ğŸ’§ 4. Perawatan & Pemupukan</h4>
    <ul class="steps-list">
        <li>Lakukan penyiraman setiap 2-3 hari sekali (tergantung kelembapan tanah).</li>
        <li>Berikan pupuk pertama pada umur 10-15 HST (Hari Setelah Tanam).</li>
        <li>Lakukan pendangiran (pembubunan tanah) bersamaan dengan pemupukan kedua.</li>
        <li>Monitor ulat grayak (Spodoptera) pada daun muda jagung setiap pagi.</li>
        <li>Pastikan lahan bersih dari rumput liar selama 6 minggu pertama pertumbuhan.</li>
    </ul>
</div>
    <div class="action-buttons">
        <a href="beranda.html" class="btn btn-primary btn-large">Selesai / Kembali ke Beranda</a>
    </div>
</main>

<footer class="footer">Â© 2025 PlantAdvisor</footer>

<script>
const API_BASE_URL = "http://plantadvisor.cloud/api";

document.addEventListener("DOMContentLoaded", () => {
    fetchRecommendation();
    updateHeaderButtons();
});

async function fetchRecommendation() {
    const inputId = localStorage.getItem("input_id");
    if (!inputId) return;

    const token = localStorage.getItem("token");
    const headers = token ? { Authorization: `Bearer ${token}` } : {};

    const res = await fetch(`${API_BASE_URL}/recommendation/${inputId}`, { headers });
    const result = await res.json();

    document.getElementById("loading-state").style.display = "none";

    if (res.ok && result.recommendations) {
        renderCards(result.recommendations);
    }
}

function renderCards(data) {
    const wrapper = document.getElementById("result-wrapper");
    wrapper.innerHTML = "";

    data.forEach(item => {
        const name = item.nama_tanaman.toLowerCase();
        let id = name.includes("padi") ? "tpl-padi" :
                 name.includes("tebu") ? "tpl-tebu" :
                 name.includes("jagung") ? "tpl-jagung" : null;
        if (!id) return;

        const clone = document.getElementById(id).cloneNode(true);
        clone.removeAttribute("id");
        clone.style.display = "block";

        const reason = document.createElement("div");
        reason.className = "plant-description";
        reason.style.background = "#eefaf2";
        reason.style.padding = "10px";
        reason.style.borderLeft = "4px solid #27ae60";
        reason.innerHTML = `<strong>ğŸ’¡ Rekomendasi Sistem:</strong><br>${item.care_instructions.replace(/\n/g,"<br>")}`;

        clone.insertBefore(reason, clone.querySelector(".section-title"));
        wrapper.appendChild(clone);
    });
}

function updateHeaderButtons() {
    const el = document.getElementById("headerButtons");
    el.innerHTML = localStorage.getItem("token")
        ? `<a href="#" class="btn btn-logout" onclick="logout(event)">Logout</a>`
        : `<a href="login.html" class="btn btn-primary">Login</a>`;
}

function logout(e){
    e.preventDefault();
    localStorage.clear();
    location.href = "beranda.html";
}
</script>
</body>
</html>