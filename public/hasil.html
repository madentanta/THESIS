<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Hasil Rekomendasi - PlantAdvisor</title>

    <link rel="stylesheet" href="style.css" /> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        .card-tanaman { display: none; }
        .container-detail {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }
        #loading-state, #error-state {
            text-align: center;
            padding: 40px;
        }
        .steps-list {
    list-style-type: none;
    padding-left: 0;
    margin-bottom: 25px;
}

.steps-list li {
    position: relative;
    padding-left: 25px;
    margin-bottom: 8px;
    line-height: 1.6;
    color: #444;
}

.steps-list li::before {
    content: "‚úîÔ∏è";
    position: absolute;
    left: 0;
    color: #27ae60;
    font-size: 14px;
}

.section-title {
    margin-top: 20px;
    color: #2c3e50;
    border-bottom: 2px solid #eee;
    padding-bottom: 5px;
}
.step {
    margin-bottom: 20px;
}
.step h5 {
    margin-bottom: 8px;
    color: #27ae60;
    font-size: 1.1rem;
    font-weight: 600;
}
.steps-list {
    margin-bottom: 15px !important;
}
.steps-list li {
    font-size: 0.95rem;
    color: #555;
    margin-bottom: 5px;
}

    .card-tanaman { display: none; }
    .container-detail {
        max-width: 900px;
        margin: 40px auto;
        padding: 20px;
    }

    /* Card Styling */
    .content-box {
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        padding: 30px;
        margin-bottom: 30px;
        border: none;
    }

    .plant-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
    }

    .plant-image {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border-radius: 12px;
    }

    .plant-header h3 {
        font-size: 28px;
        font-weight: 800;
        color: #1a365d;
    }

    .section-title {
        font-size: 20px;
        font-weight: 700;
        margin: 30px 0 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    /* Step Container Styling (Sesuai Gambar) */
    .step {
        background: #f8fafc; /* Abu-abu sangat muda */
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        display: flex;
        gap: 15px;
        border-left: 5px solid #a3e635; /* Garis hijau di samping */
    }

    .step-number {
        background: #a3e635; /* Warna hijau limau sesuai gambar */
        color: #fff;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        flex-shrink: 0;
    }

    .step-content h5 {
        margin: 0 0 10px 0;
        font-size: 18px;
        font-weight: 700;
        color: #334155;
    }

    .steps-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .steps-list li {
        position: relative;
        padding-left: 20px;
        font-size: 15px;
        color: #64748b;
        line-height: 1.6;
        margin-bottom: 5px;
    }

    .steps-list li::before {
        content: "üå±"; /* Bullet points sesuai tema */
        position: absolute;
        left: 0;
        font-size: 12px;
    }

    /* Loading & Error */
    #loading-state, #error-state {
        text-align: center;
        padding: 40px;
    }
    </style>
</head>

<body>
<header class="main-header">
    <div class="logo">PlantAdvisor</div>
    <nav class="main-nav">
        <a href="beranda.html">Beranda</a>
    </nav>
    <div class="header-buttons" id="headerButtons"></div>
</header>

<main class="container-detail">
    <h2 class="page-title">
        <a href="beranda.html" class="back-link">&lt;</a> Hasil Rekomendasi Tanaman
    </h2>

    <div id="loading-state" class="content-box">
        <p>‚öôÔ∏è <b>Memproses data tanah...</b> Mohon tunggu sebentar.</p>
    </div>
    <div id="error-state" class="content-box" style="display:none; border-left:5px solid #e74c3c;">
        <p id="error-message">‚ùå Gagal memuat rekomendasi.</p>
    </div>

    <div id="result-wrapper"></div>

    <div id="tpl-padi" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="padi.png" class="plant-image" alt="Padi"/>
            <h3>Tanaman Padi</h3>
        </div>
        <p class="plant-description">Padi membutuhkan tanah yang dapat menahan air (lempung) dan paparan sinar matahari penuh untuk pertumbuhan optimal.</p>
        
        <h4 class="section-title">üåæ Cara Menanam Padi</h4>
        
        <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
                <h5>Pemilihan Benih</h5>
                <ul class="steps-list">
                    <li>Gunakan benih unggul bersertifikat (Label Biru).</li>
                    <li>Rendam benih dalam air garam; pilih yang tenggelam.</li>
                    <li>Rendam benih pilihan selama 24-48 jam hingga berkecambah.</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
                <h5>Penyemaian</h5>
                <ul class="steps-list">
                    <li>Siapkan bedengan semai dengan perbandingan tanah & pupuk 1:1.</li>
                    <li>Tebar benih secara merata di atas bedengan basah.</li>
                    <li>Rawat bibit selama 18-22 hari sebelum dipindah ke lahan utama.</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
                <h5>Penanaman & Perawatan</h5>
                <ul class="steps-list">
                    <li>Tanam 2-3 bibit per lubang dengan kedalaman 2-3 cm.</li>
                    <li>Gunakan sistem Jajar Legowo untuk sirkulasi udara optimal.</li>
                    <li>Berikan pupuk Urea, SP-36, dan KCl secara berkala.</li>
                    <li>Jaga genangan air setinggi 2-5 cm di area persawahan.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tpl-tebu" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="tebu.png" class="plant-image" alt="Tebu"/>
            <h3>Tanaman Tebu</h3>
        </div>
        <p class="plant-description">Tebu adalah tanaman industri yang membutuhkan tanah gembur dengan sistem drainase yang sangat baik.</p>
        
        <h4 class="section-title">üéã Cara Menanam Tebu</h4>
        
        <div class="step">
            <div class="step-number">1</div>
            <div class="step-content">
                <h5>Persiapan Lahan</h5>
                <ul class="steps-list">
                    <li>Bajak lahan sedalam 30 cm agar akar berkembang bebas.</li>
                    <li>Buat juringan (parit) dengan kedalaman 25-30 cm.</li>
                    <li>Berikan kapur pertanian jika pH tanah di bawah 5.5.</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
                <h5>Penanaman Stek</h5>
                <ul class="steps-list">
                    <li>Gunakan bibit stek dengan 2-3 mata tunas yang sehat.</li>
                    <li>Letakkan stek secara mendatar di dasar juringan.</li>
                    <li>Tutup dengan tanah tipis (5-7 cm) agar tunas mudah keluar.</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
                <h5>Pemeliharaan</h5>
                <ul class="steps-list">
                    <li>Lakukan pembumbunan (penimbunan tanah di pangkal batang).</li>
                    <li>Klentek (buang daun kering) secara rutin untuk mempercepat masak.</li>
                    <li>Pastikan lahan tidak tergenang air terlalu lama.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tpl-jagung" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="jagung.jpeg" class="plant-image" alt="Jagung"/>
            <h3>Tanaman Jagung</h3>
        </div>
        <p class="plant-description">Jagung membutuhkan tanah yang subur, kaya Nitrogen, dan tidak mudah menggenang.</p>
        
        <h4 class="section-title">üåΩ Cara Menanam Jagung</h4>
        
        <div class="step">
            <div class="step-number">1</div>
            <div class="step-number-extra" style="display:none"></div> <div class="step-content">
                <h5>Penyiapan Benih</h5>
                <ul class="steps-list">
                    <li>Pilih benih hibrida yang tahan terhadap penyakit bulai.</li>
                    <li>Pastikan benih sudah diberi fungisida (seed treatment).</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
                <h5>Penanaman</h5>
                <ul class="steps-list">
                    <li>Tanam benih dengan teknik tugal sedalam 3-5 cm.</li>
                    <li>Isi 1 lubang dengan 1 biji (jika daya tumbuh di atas 95%).</li>
                    <li>Gunakan jarak tanam 75 cm x 20 cm untuk hasil maksimal.</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
                <h5>Pemupukan & Pengairan</h5>
                <ul class="steps-list">
                    <li>Pupuk pertama di umur 15 hari, kedua di umur 35 hari.</li>
                    <li>Pastikan pengairan cukup terutama saat fase berbunga.</li>
                    <li>Lakukan penyiangan gulma agar nutrisi tidak terbagi.</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="action-buttons">
        <a href="beranda.html" class="btn btn-primary btn-large" style="background-color: #a3e635; border: none; color: #fff; font-weight: bold;">Selesai / Kembali ke Beranda</a>
    </div>
</main>

<footer class="footer">¬© 2025 PlantAdvisor</footer>

<script>
const API_BASE_URL = "http://plantadvisor.cloud/api";

document.addEventListener("DOMContentLoaded", () => {
    fetchRecommendation();
    updateHeaderButtons();
});

async function fetchRecommendation() {
    const inputId = localStorage.getItem("input_id");
    if (!inputId) return;

    const token = localStorage.getItem("token");
    const headers = token ? { Authorization: `Bearer ${token}` } : {};

    const res = await fetch(`${API_BASE_URL}/recommendation/${inputId}`, { headers });
    const result = await res.json();

    document.getElementById("loading-state").style.display = "none";

    if (res.ok && result.recommendations) {
        renderCards(result.recommendations);
    }
}

function renderCards(data) {
    const wrapper = document.getElementById("result-wrapper");
    wrapper.innerHTML = "";

    data.forEach(item => {
        const name = item.nama_tanaman.toLowerCase();
        let id = name.includes("padi") ? "tpl-padi" :
                 name.includes("tebu") ? "tpl-tebu" :
                 name.includes("jagung") ? "tpl-jagung" : null;
        if (!id) return;

        const clone = document.getElementById(id).cloneNode(true);
        clone.removeAttribute("id");
        clone.style.display = "block";

        const reason = document.createElement("div");
        reason.className = "plant-description";
        reason.style.background = "#eefaf2";
        reason.style.padding = "10px";
        reason.style.borderLeft = "4px solid #27ae60";
        reason.innerHTML = `<strong>üí° Rekomendasi Sistem:</strong><br>${item.care_instructions.replace(/\n/g,"<br>")}`;

        clone.insertBefore(reason, clone.querySelector(".section-title"));
        wrapper.appendChild(clone);
    });
}

function updateHeaderButtons() {
    const el = document.getElementById("headerButtons");
    el.innerHTML = localStorage.getItem("token")
        ? `<a href="#" class="btn btn-logout" onclick="logout(event)">Logout</a>`
        : `<a href="login.html" class="btn btn-primary">Login</a>`;
}

function logout(e){
    e.preventDefault();
    localStorage.clear();
    location.href = "beranda.html";
}
</script>
</body>
</html>