<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Hasil Rekomendasi - PlantAdvisor</title>

    <link rel="stylesheet" href="style.css" /> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        .card-tanaman { display: none; }
        .container-detail {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }
        #loading-state, #error-state {
            text-align: center;
            padding: 40px;
        }
    </style>
</head>

<body>
<header class="main-header">
    <div class="logo">PlantAdvisor</div>
    <nav class="main-nav">
        <a href="beranda.html">Beranda</a>
    </nav>
    <div class="header-buttons" id="headerButtons"></div>
</header>

<main class="container-detail">
    <h2 class="page-title">
        <a href="beranda.html" class="back-link">&lt;</a> Hasil Rekomendasi Tanaman
    </h2>

    <div id="loading-state" class="content-box">
        <p>âš™ï¸ <b>Memproses data tanah...</b> Mohon tunggu sebentar.</p>
    </div>

    <div id="error-state" class="content-box" style="display:none; border-left:5px solid #e74c3c;">
        <p id="error-message">âŒ Gagal memuat rekomendasi.</p>
    </div>

    <div id="result-wrapper"></div>

    <!-- ================= TEMPLATE PADI ================= -->
    <div id="tpl-padi" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="padi.png" class="plant-image"/>
            <h3>Tanaman Padi</h3>
        </div>
        <p class="plant-description">
            Padi merupakan tanaman pangan utama di Indonesia yang menghasilkan beras dan membutuhkan
            lahan tergenang air pada fase awal pertumbuhan.
        </p>
        <h4 class="section-title">ğŸŒ¾ Cara Menanam Padi</h4>
        <div class="step-by-step">
            <div class="tanpa-list-style step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h5>Pemilihan Benih</h5>
                    <ul>
                        <li>Gunakan benih unggul bersertifikat.</li>
                        <li>Rendam benih selama 24 jam.</li>
                    </ul>
                </div>
            </div>
            <div class="tanpa-list-style step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h5>Penyemaian</h5>
                    <ul>
                        <li>Siapkan lahan semai basah.</li>
                        <li>Tebar benih secara merata.</li>
                    </ul>
                </div>
            </div>
            <div class="tanpa-list-style step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h5>Penanaman</h5>
                    <ul>
                        <li>Pindahkan bibit umur 20 hari.</li>
                        <li>Gunakan jarak tanam 25x25 cm.</li>
                    </ul>
                </div>
            </div>
            <div class="tanpa-list-style step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h5>Pemeliharaan</h5>
                    <ul>
                        <li>Atur irigasi air.</li>
                        <li>Pemupukan urea berkala.</li>
                    </ul>
                </div>
            </div>
            <div class="tanpa-list-style step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h5>Panen</h5>
                    <ul>
                        <li>Panen umur 3â€“4 bulan.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= TEMPLATE TEBU ================= -->
    <div id="tpl-tebu" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="tebu.png" class="plant-image"/>
            <h3>Tanaman Tebu</h3>
        </div>
        <p class="plant-description">
            Tebu merupakan bahan baku utama gula dan membutuhkan sinar matahari penuh.
        </p>
        <h4 class="section-title">ğŸ‹ Cara Menanam Tebu</h4>
        <div class="step-by-step">
            <div class="tanpa-list-style step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h5>Benih</h5>
                    <ul><li>Gunakan stek batang sehat.</li></ul>
                </div>
            </div>
            <div class="tanpa-list-style step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h5>Penanaman</h5>
                    <ul><li>Buat juringan 20â€“30 cm.</li></ul>
                </div>
            </div>
            <div class="tanpa-list-style step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h5>Pemeliharaan</h5>
                    <ul><li>Pembumbunan rutin.</li></ul>
                </div>
            </div>
            <div class="tanpa-list-style step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h5>Panen</h5>
                    <ul><li>Umur 10â€“12 bulan.</li></ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= TEMPLATE JAGUNG ================= -->
    <div id="tpl-jagung" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="jagung.png" class="plant-image"/>
            <h3>Tanaman Jagung</h3>
        </div>
        <p class="plant-description">
            Jagung merupakan tanaman palawija serbaguna.
        </p>
        <h4 class="section-title">ğŸŒ½ Cara Menanam Jagung</h4>
        <div class="step-by-step">
            <div class="tanpa-list-style step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h5>Benih</h5>
                    <ul><li>Gunakan benih hibrida.</li></ul>
                </div>
            </div>
            <div class="tanpa-list-style step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h5>Penanaman</h5>
                    <ul><li>Tugal sedalam 3â€“5 cm.</li></ul>
                </div>
            </div>
            <div class="tanpa-list-style step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h5>Panen</h5>
                    <ul><li>Umur Â±3 bulan.</li></ul>
                </div>
            </div>
        </div>
    </div>

    <div class="action-buttons">
        <a href="beranda.html" class="btn btn-primary btn-large">Selesai / Kembali ke Beranda</a>
    </div>
</main>

<footer class="footer">Â© 2025 PlantAdvisor</footer>

<script>
const API_BASE_URL = "http://plantadvisor.cloud/api";

document.addEventListener("DOMContentLoaded", () => {
    fetchRecommendation();
    updateHeaderButtons();
});

async function fetchRecommendation() {
    const inputId = localStorage.getItem("input_id");
    if (!inputId) return;

    const token = localStorage.getItem("token");
    const headers = token ? { Authorization: `Bearer ${token}` } : {};

    const res = await fetch(`${API_BASE_URL}/recommendation/${inputId}`, { headers });
    const result = await res.json();

    document.getElementById("loading-state").style.display = "none";

    if (res.ok && result.recommendations) {
        renderCards(result.recommendations);
    }
}

function renderCards(data) {
    const wrapper = document.getElementById("result-wrapper");
    wrapper.innerHTML = "";

    data.forEach(item => {
        const name = item.nama_tanaman.toLowerCase();
        let id = name.includes("padi") ? "tpl-padi" :
                 name.includes("tebu") ? "tpl-tebu" :
                 name.includes("jagung") ? "tpl-jagung" : null;
        if (!id) return;

        const clone = document.getElementById(id).cloneNode(true);
        clone.removeAttribute("id");
        clone.style.display = "block";

        const reason = document.createElement("div");
        reason.className = "plant-description";
        reason.style.background = "#eefaf2";
        reason.style.padding = "10px";
        reason.style.borderLeft = "4px solid #27ae60";
        reason.innerHTML = `<strong>ğŸ’¡ Rekomendasi Sistem:</strong><br>${item.care_instructions.replace(/\n/g,"<br>")}`;

        clone.insertBefore(reason, clone.querySelector(".section-title"));
        wrapper.appendChild(clone);
    });
}

function updateHeaderButtons() {
    const el = document.getElementById("headerButtons");
    el.innerHTML = localStorage.getItem("token")
        ? `<a href="#" class="btn btn-logout" onclick="logout(event)">Logout</a>`
        : `<a href="login.html" class="btn btn-primary">Login</a>`;
}

function logout(e){
    e.preventDefault();
    localStorage.clear();
    location.href = "beranda.html";
}
</script>
</body>
</html>
