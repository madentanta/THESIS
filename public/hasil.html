<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Hasil Rekomendasi - PlantAdvisor</title>

    <link rel="stylesheet" href="style.css" /> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">


    <style>
        body {
            background-color: #f3f4f6;
            font-family: 'Inter', sans-serif;
            color: #1e293b;
            margin: 0;
            padding: 0;
        }

        .card-tanaman { display: none; } /* Disembunyikan untuk dipanggil JS */

        .container-detail {
            max-width: 850px;
            margin: 40px auto;
            padding: 20px;
        }

        .content-box {
            background: #fff;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid #eee;
        }

        .plant-header {
            display: flex;
            align-items: center;
            gap: 25px;
            margin-bottom: 30px;
        }

        .plant-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 20px;
            background: #f0f0f0;
        }

        .plant-header h3 {
            font-size: 28px;
            font-weight: 800;
            margin: 0;
            color: #1a365d;
        }

        .section-title {
            font-size: 20px;
            font-weight: 700;
            margin: 35px 0 20px;
            color: #334155;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Styling Step 1-5 */
        .step {
            background: #f8fafc;
            border-radius: 18px;
            padding: 20px 25px;
            margin-bottom: 15px;
            display: flex;
            gap: 20px;
            border-left: 6px solid #c1d72e;
            transition: transform 0.2s ease;
        }

        .step:hover {
            transform: translateX(5px);
        }

        .step-number {
            background: #c1d72e;
            color: #fff;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            flex-shrink: 0;
            font-size: 14px;
            box-shadow: 0 4px 10px #c1d72e;
        }

        .step-content h5 {
            margin: 0 0 8px 0;
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
        }

        .steps-list {
            list-style: none;
            padding: 0;
            margin: 0 !important;
        }

        .steps-list li {
            position: relative;
            padding-left: 25px;
            font-size: 14.5px;
            color: #475569;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .steps-list li::before {
            content: "ğŸŒ±";
            position: absolute;
            left: 0;
            font-size: 12px;
            top: 3px;
        }

        .action-buttons {
            text-align: center;
            margin-top: 50px;
        }

        .btn-large {
            padding: 18px 50px;
            background-color: #c1d72e;
            color: black;
            border-radius: 15px;
            font-weight: 700;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }
        .btn-large:hover {
             background-color: #9fb22b;
            transform: translateY(-2px);
}

        .analysis-box {
            background: #f9fbe7;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 4px solid #c1d72e;
            font-size: 14px;
            line-height: 1.6;
        }
        .latin-name {
    font-size: 0.8em;
}
/* Gaya untuk Header Step yang bisa diklik */
.step-header {
    display: flex;
    align-items: center;
    gap: 20px;
    cursor: pointer;
    width: 100%;
}

/* Sembunyikan konten secara default */
.step-content {
    display: none;
    padding-top: 15px;
    padding-left: 55px; /* Menyesuaikan posisi dengan angka */
}

/* Ikon panah/dropdown */
.step::after {
    content: 'â–¼';
    font-size: 12px;
    color: #94a3b8;
    margin-left: auto;
    transition: transform 0.3s ease;
}

/* Class aktif saat dropdown terbuka */
.step.active::after {
    transform: rotate(180deg);
}

.step.active .step-content {
    display: block;
}

/* Penyesuaian padding step agar lebih rapi */
.step {
    flex-direction: column; /* Ubah ke kolom agar konten di bawah header */
    align-items: flex-start;
}
    </style>
</head>

<body>
<header class="main-header">
    <div class="logo">PlantAdvisor</div>
    <div class="header-buttons" id="headerButtons"></div>
</header>
<main class="container-detail">
    <h2 class="page-title" style="font-weight: 800; margin-bottom: 30px;">
        <a href="beranda.html" style="text-decoration: none; color: #334155;">&lt;</a> Hasil Rekomendasi
    </h2>

    <div id="loading-state" class="content-box" style="text-align: center;">
        <p>âš™ï¸ <b>Menganalisis data tanah...</b></p>
    </div>

    <div id="empty-state" class="content-box" style="display:none; text-align:center;">
    <p><b>ğŸŒ± Tidak ada rekomendasi tanaman</b></p>
    <p>Data tanah tidak sesuai dengan tanaman yang tersedia.</p>
    </div>


    <div id="result-wrapper"></div>

    <div id="tpl-padi" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="padi.png" class="plant-image" alt="Padi"/>
            <h3>Tanaman Padi <span class="latin-name">(Oryza sativa)</span></h3>

        </div>
        
        <h4 class="section-title">ğŸŒ¾ Panduan Budidaya - Panen</h4>

        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">1</div>
        <h4>Persiapan Lahan</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Lahan sawah diolah terlebih dahulu dengan pembajakan dan penggaruan hingga tanah menjadi lumpur yang homogen.</li>
                    <li>Pastikan petakan sawah memiliki sistem pematang dan saluran drainase yang baik untuk mengatur tinggi genangan air.</li>
                    <li>Pengolahan tanah bertujuan memperbaiki struktur tanah, meningkatkan aerasi, dan mendukung perkembangan perakaran padi.</li>
                </ul>
            </div>
        </div>
        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">2</div>
        <h4>Penyemaian</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Gunakan benih padi unggul</li>
                    <li>Umur bibit saat siap dipindahkan ke lahan tanam (Â±19â€“23 hari).</li>
                    <li>Bibit berasal dari persemaian yang terkelola dengan baik.</li>            
                    <li>Bibit siap tanam sesuai standar teknis budidaya padi.</li>
                </ul>
            </div>
        </div>
        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">3</div>
        <h4>Penanaman</h4>
    </div>
    <div class="step-content">
                <ul class="steps-list">
                     <li>Bibit ditanam dengan jarak tanam 25 cm Ã— 25 cm.</li>
                    <li>Gunakan 2 bibit per lubang tanam.</li>
                    <li>Penanaman dilakukan secara hati-hati untuk menghindari kerusakan akar.</li>
                </ul>
            </div>
        </div>
        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">4</div>
        <h4>Pengaturan Tata Air</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Pengairan tergenang : Tinggi genangan air Â±7â€“10 cm, Air dipertahankan hingga memasuki fase generatif</li>
                    <li>Setelah itu, Air diberikan secukupnya hingga permukaan tanah basah dan berlumpur.</li>
                    <li>Tidak ada air yang menggenang di atas permukaan tanah.</li>
                    <li>Setelah air meresap, pengairan dihentikan sementara.</li>
                    <li>Pengairan dilakukan kembali jika tanah mulai retak halus atau terlihat mulai kering..</li>
                </ul>
            </div>
        </div>
        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">5</div>
        <h4>Pemupukan</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Berikan pupuk NPK sebagai pupuk dasar sebelum atau sesaat setelah tanam.</li>
                    <li>Lakukan pemupukan susulan pada umur 2â€“4 minggu setelah tanam untuk mendukung pertumbuhan anakan.</li>
                    <li>Kurangi genangan air saat pemupukan agar pupuk tidak hanyut dan mudah diserap akar.</li>
                </ul>
            </div>
        </div>
        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">5</div>
        <h4>Perawatan</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Lakukan pengendalian gulma secara rutin.</li>
                    <li>Pantau pertumbuhan tanaman, terutama Tinggi tanaman dan Jumlah anakan (4, 6, dan 8 MST).</li>
                    <li>Jaga kondisi air agar tidak terjadi genangan berlebih dalam waktu lama.</li>
                </ul>
            </div>
        </div>
        <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">5</div>
        <h4>Panen</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Panen padi saat bulir sudah menguning dan matang sempurna.</li>
                    <li>Potong tanaman padi dan kumpulkan gabah hasil panen.</li>
                    <li>Timbang gabah sebagai gabah kering panen (GKP).</li>
                    <li>Jemur gabah selama Â±7 hari hingga kering.</li>
                    <li>Timbang kembali gabah kering sebagai gabah kering giling (GKG).</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tpl-jagung" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="jagung.jpeg" class="plant-image" alt="Jagung"/>
            <h3>Tanaman Jagung <span class="latin-name">(Zea mays)</span></h3>

        </div>
        <h4 class="section-title">ğŸŒ½ Panduan Budidaya - Panen</h4>

         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">1</div>
        <h4>Persiapan Lahan</h4>
    </div>
    <div class="step-content">
       <ul class="steps-list">
                    <li>Bersihkan lahan dari gulma dan sisa tanaman.</li>
                    <li>Gemburkan tanah untuk memperbaiki aerasi dan drainase.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">2</div>
        <h4>Persiapan Benih</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Gunakan benih jagung hibrida berkualitas (misal BISI 18).</li>
                    <li>Pilih benih sehat dan bebas hama penyakit.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">3</div>
        <h4>Penanaman</h4>
    </div>
    <div class="step-content">
         <ul class="steps-list">
                    <li>Buat lubang tanam menggunakan tugal.</li>
                    <li>Tanam 1 benih per lubang.</li>
                    <li>Tutup benih dengan tanah tipis dan siram secukupnya.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">4</div>
        <h4>Pemeliharaan</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Lakukan penyiraman sesuai kebutuhan tanaman.</li>
                    <li>Kendalikan gulma dengan penyiangan manual.</li>
                    <li>Lakukan pengendalian hama dan penyakit bila diperlukan.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">5</div>
        <h4>Panen</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Panen dilakukan saat biji jagung telah masak fisiologis.</li>
                    <li>Petik atau potong bonggol jagung dari batang tanaman.</li>
                    <li>Kumpulkan bonggol hasil panen di satu tempat.</li>
                     <li>Keringkan bonggol hingga kadar air menurun.</li>
                      <li>Jagung siap dipipil atau ditimbang sesuai kebutuhan.</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tpl-tebu" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="tebu.png" class="plant-image" alt="Tebu"/>
            <h3>
            Tanaman Tebu 
            <span class="latin-name" style="font-size: 0.8em;">
                 (Saccharum officinarum)
            </span>
            </h3>


        </div>
        <h4 class="section-title">ğŸ‹ Panduan Budidaya - Panen</h4>

         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">1</div>
        <h4>Persiapan Lahan</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
               <li>Gunakan tanah lapisan atas (top soil) yang subur dan bersih dari gulma.</li>
                    <li>Gunakan tanah lapisan atas (top soil) yang subur dan bersih dari gulma.</li>
                    <li>Campurkan tanah dengan pupuk kandang (misalnya kotoran sapi) hingga homogen.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">2</div>
        <h4>Persiapan Benih</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                  <li></li>
                    <li>Pilih batang tebu yang segar, tidak rusak, dan bebas hama penyakit.</li>
                    <li>Bahan tanam diambil dari mata tunas pada ruas ke-3 dari pangkal hingga ruas ke-3 dari pucuk.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">3</div>
        <h4>Penanaman</h4>
    </div>
    <div class="step-content">
       <ul class="steps-list">
                  <li>Batang tebu dipotong menjadi bud sett berisi satu mata tunas dengan panjang Â±5 cm.</li>
                    <li>Buat lubang tanam sedalam Â±3 cm.</li>
                    <li>Bud sett ditanam dengan posisi mata tunas menghadap ke atas, kemudian ditutup tanah dan dipadatkan ringan.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">4</div>
        <h4>Pemeliharaan</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Penyiraman dilakukan secara teratur untuk menjaga kelembapan tanah.</li>
                    <li>Pengendalian gulma dilakukan sejak fase awal pertumbuhan.</li>
                    <li>Tanaman dipelihara hingga terbentuk daun dan anakan secara optimal.</li>
                </ul>
            </div>
        </div>
         <div class="step" onclick="toggleStep(this)">
    <div class="step-header">
        <div class="step-number">5</div>
        <h4>Panen</h4>
    </div>
    <div class="step-content">
        <ul class="steps-list">
                    <li>Panen dilakukan saat tanaman tebu mencapai umur panen optimal.</li>
                    <li>Ciri tebu siap panen ditandai dengan batang keras dan daun bagian bawah mengering</li>
                    <li>Panen dilakukan dengan memotong batang tebu menggunakan alat tajam (parang/sabit) sedekat mungkin dengan permukaan tanah.</li>
                    <li>Daun dan pucuk tebu dibersihkan dari batang hasil panen.</li>
                    <li>Batang tebu yang telah dipanen dikumpulkan dan diangkut ke tempat pengolahan atau penimbangan.</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="action-buttons">
        <a href="beranda.html" class="btn-large">Selesai / Kembali ke Beranda</a>
    </div>
</main>

<script>
    const API_BASE_URL = "https://plantadvisor.cloud/api";

    document.addEventListener("DOMContentLoaded", () => {
        fetchRecommendation();
    });

async function fetchRecommendation() {
    const inputId = localStorage.getItem("input_id");

    // jika input_id tidak ada
    if (!inputId) {
        document.getElementById("loading-state").style.display = "none";
        document.getElementById("empty-state").style.display = "block";
        return;
    }

    try {
        const res = await fetch(`${API_BASE_URL}/recommendation/${inputId}`);
        const result = await res.json();

        document.getElementById("loading-state").style.display = "none";

        // jika ada rekomendasi
        if (
            res.ok &&
            Array.isArray(result.recommendations) &&
            result.recommendations.length > 0
        ) {
            renderCards(result.recommendations);
        } 
        // jika kosong / gagal
        else {
            document.getElementById("empty-state").style.display = "block";
        }
    } catch (error) {
        console.error(error);
        document.getElementById("loading-state").style.display = "none";
        document.getElementById("empty-state").style.display = "block";
    }
}


    function renderCards(data) {
        const wrapper = document.getElementById("result-wrapper");
        wrapper.innerHTML = "";
        
        data.forEach(item => {
            const name = item.nama_tanaman.toLowerCase();
            let id = name.includes("padi") ? "tpl-padi" :
                     name.includes("tebu") ? "tpl-tebu" : 
                     name.includes("jagung") ? "tpl-jagung" : null;
            
            if (!id) return;

            const clone = document.getElementById(id).cloneNode(true);
            clone.removeAttribute("id");
            clone.style.display = "block";

            // Tambahkan Box Analisis dari Database
            const analysis = document.createElement("div");
            analysis.className = "analysis-box";
            analysis.innerHTML = `<b>Ensiklopedia</b><br>${item.care_instructions.replace(/\n/g,"<br>")}`;

            clone.insertBefore(analysis, clone.querySelector(".section-title"));
            wrapper.appendChild(clone);
        });
    }
    // Fungsi untuk toggle dropdown
function toggleStep(element) {
    // Menutup step lain yang sedang terbuka (Opsional, hapus jika ingin bisa buka banyak sekaligus)
    /*
    const allSteps = document.querySelectorAll('.step');
    allSteps.forEach(step => {
        if(step !== element) step.classList.remove('active');
    });
    */

    // Toggle class active pada elemen yang diklik
    element.classList.toggle('active');
}

// Pastikan fungsi renderCards tetap berjalan seperti biasa, 
// karena struktur internalnya sudah kita siapkan di template.
</script>
</body>
</html>