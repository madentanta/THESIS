<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Hasil Rekomendasi - PlantAdvisor</title>

    <link rel="stylesheet" href="style.css" /> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        .card-tanaman { display: none; }

        .container-detail {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }

        #loading-state, #error-state {
            text-align: center;
            padding: 40px;
        }
    </style>
</head>

<body>
<header class="main-header">
    <div class="logo">PlantAdvisor</div>
    <nav class="main-nav">
        <a href="beranda.html">Beranda</a>
    </nav>
    <div class="header-buttons" id="headerButtons"></div>
</header>

<main class="container-detail">
    <h2 class="page-title">
        <a href="beranda.html" class="back-link">&lt;</a> Hasil Rekomendasi Tanaman
    </h2>

    <div id="loading-state" class="content-box">
        <p>âš™ï¸ <b>Memproses data tanah...</b> Mohon tunggu sebentar.</p>
    </div>

    <div id="error-state" class="content-box" style="display:none; border-left: 5px solid #e74c3c;">
        <p id="error-message">âŒ Gagal memuat rekomendasi.</p>
    </div>

    <div id="result-wrapper"></div>

    <!-- TEMPLATE PADI -->
    <div id="tpl-padi" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="padi.png" class="plant-image"/>
            <h3>Tanaman Padi</h3>
        </div>
        <p class="plant-description">
            Padi merupakan tanaman pangan utama di Indonesia yang membutuhkan lahan tergenang air.
        </p>
        <h4 class="section-title">ğŸŒ¾ Cara Menanam Padi</h4>
    </div>

    <!-- TEMPLATE TEBU -->
    <div id="tpl-tebu" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="tebu.png" class="plant-image"/>
            <h3>Tanaman Tebu</h3>
        </div>
        <p class="plant-description">
            Tebu adalah bahan baku utama pembuatan gula dan membutuhkan sinar matahari penuh.
        </p>
        <h4 class="section-title">ğŸ‹ Cara Menanam Tebu</h4>
    </div>

    <!-- TEMPLATE JAGUNG -->
    <div id="tpl-jagung" class="card-tanaman content-box">
        <div class="plant-header">
            <img src="jagung.png" class="plant-image"/>
            <h3>Tanaman Jagung</h3>
        </div>
        <p class="plant-description">
            Jagung merupakan tanaman palawija yang mudah dibudidayakan.
        </p>
        <h4 class="section-title">ğŸŒ½ Cara Menanam Jagung</h4>
    </div>

    <div class="action-buttons">
        <a href="beranda.html" class="btn btn-primary btn-large">Selesai / Kembali ke Beranda</a>
    </div>
</main>

<footer class="footer">
    Â© 2025 PlantAdvisor. All rights reserved.
</footer>

<script>
const API_BASE_URL = 'http://plantadvisor.cloud/api'; 

document.addEventListener("DOMContentLoaded", () => {
    fetchRecommendation();
    updateHeaderButtons();
});

async function fetchRecommendation() {
    const inputId = localStorage.getItem("input_id");
    const loadingState = document.getElementById("loading-state");
    const errorState = document.getElementById("error-state");

    if (!inputId) {
        loadingState.innerHTML = "âŒ Data input tidak ditemukan.";
        return;
    }

    try {
        const token = localStorage.getItem("token");
        const headers = token ? { "Authorization": `Bearer ${token}` } : {};

        const response = await fetch(`${API_BASE_URL}/recommendation/${inputId}`, { headers });
        const result = await response.json();

        loadingState.style.display = "none";

        if (response.ok && result.recommendations) {
            renderCards(result.recommendations);
        } else {
            throw new Error(result.message || "Gagal mengambil rekomendasi.");
        }

    } catch (err) {
        loadingState.style.display = "none";
        errorState.style.display = "block";
        document.getElementById("error-message").innerText = err.message;
    }
}

function renderCards(data) {
    const wrapper = document.getElementById("result-wrapper");
    wrapper.innerHTML = "";

    data.forEach(item => {
        const name = item.nama_tanaman.toLowerCase();
        let tplId = "";

        if (name.includes("padi")) tplId = "tpl-padi";
        else if (name.includes("tebu")) tplId = "tpl-tebu";
        else if (name.includes("jagung")) tplId = "tpl-jagung";

        if (!tplId) return;

        const template = document.getElementById(tplId);
        const clone = template.cloneNode(true);

        const reason = document.createElement("div");
        reason.className = "plant-description";
        reason.style.background = "#eefaf2";
        reason.style.padding = "10px";
        reason.style.borderRadius = "8px";
        reason.style.borderLeft = "4px solid #27ae60";
        reason.innerHTML = `<strong>ğŸ’¡ Rekomendasi Sistem:</strong><br>${item.care_instructions.replace(/\n/g,"<br>")}`;

        clone.style.display = "block";
        clone.insertBefore(reason, clone.querySelector(".section-title"));
        wrapper.appendChild(clone);
    });
}

function updateHeaderButtons() {
    const headerButtons = document.getElementById("headerButtons");
    const token = localStorage.getItem("token");

    if (token) {
        headerButtons.innerHTML =
            `<a href="#" class="btn btn-logout" onclick="handleLogout(event)">Logout</a>`;
    } else {
        headerButtons.innerHTML =
            `<a href="login.html" class="btn btn-primary">Login</a>`;
    }
}

function handleLogout(e) {
    e.preventDefault();
    localStorage.clear();
    window.location.href = "beranda.html";
}
</script>
</body>
</html>
